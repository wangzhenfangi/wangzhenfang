# 项目总结	



# 项目搭建

搭建一个总父项目

mingrui-shop-parent      

搭建四个子父项目

mingrui-shop-basics         注册中心 网关

mingrui-shop-commons    公共类 或工具类

mingrui-shop-services  实现类 和 mapper

mingrui-shop-services-api 接口 和实体类



pom.xml  

```java
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
		http://maven.apache.org/xsd/maven-4.0.0.xsd">
 <modelVersion>4.0.0</modelVersion>
 <groupId>com.baidu</groupId>
 <artifactId>mingrui-shop-parent</artifactId>
 <version>1.0-SNAPSHOT</version>
 <!--父级项目不需要打包所有packging的类型为pom-->
 <packaging>pom</packaging>
 <properties>
   <!--项目构建编码-->
   <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
   <project.reporting.outputEncoding>UTF-
8</project.reporting.outputEncoding>
   <!--声明JDK版本-->
   <java.version>1.8</java.version>
   <!--spring cloud 版本.注意此版本是建立在boot2.2.2版本上的-->
   <mr.spring.cloud.version>Hoxton.SR1</mr.spring.cloud.version>
 </properties>
 <!--boot 版本-->
 <parent>
   <groupId>org.springframework.boot</groupId>
   <artifactId>spring-boot-starter-parent</artifactId>
   <version>2.3.1.RELEASE</version>
   <!--始终从仓库中获取，不从本地路径获取-->
   <relativePath />
 </parent>
 <dependencies>
   <!-- 集成commons工具类 -->
   <dependency>
     <groupId>org.apache.commons</groupId>
     <artifactId>commons-lang3</artifactId>
   </dependency>
   <!-- 集成lombok 框架 -->
   <dependency>
     <groupId>org.projectlombok</groupId>
     <artifactId>lombok</artifactId>
   </dependency>
   <!--junit测试-->
   <dependency>
     <groupId>junit</groupId>
     <artifactId>junit</artifactId>
   </dependency>
   <!-- SpringBoot整合eureka客户端 -->
   <dependency>
     <groupId>org.springframework.cloud</groupId>
     <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
   </dependency>
   <!--boot 测试模块-->
   <dependency>
     <groupId>org.springframework.boot</groupId>
     <artifactId>spring-boot-starter-test</artifactId>
     <scope>test</scope>
   </dependency>
 </dependencies>
 <!-- 项目依赖,子级模块可以继承依赖-->
 <dependencyManagement>
   <dependencies>
     <!--cloud 依赖-->
     <dependency>
       <groupId>org.springframework.cloud</groupId>
       <artifactId>spring-cloud-dependencies</artifactId>
       <version>${mr.spring.cloud.version}</version>
       <type>pom</type>
       <!--解决maven单继承的问题-->
       <scope>import</scope>
     </dependency>
   </dependencies>
 </dependencyManagement>
 <!-- 注意： 这里必须要添加， 否者各种依赖有问题 -->
 <repositories>
   <repository>
     <id>spring-milestones</id>
     <name>Spring Milestones</name>
     <url>https://repo.spring.io/libs-milestone</url>
     <snapshots>
       <enabled>false</enabled>
     </snapshots>
   </repository>
 </repositories>
</project>
```

# 





# 品牌项目总结	

思路

#### 修改功能

1.通过前台传来的id或实体类

2.执行普通的修改操作

3.先通过brandId删除中间表的数据

4.批量新增 / 新增

4.1得到分类集合字符串

4.2判断分类集合字符串中是否包含, （包含批量不包含普通新增）

4.3多个分类 --> 批量新增

5.普通单个新增

#### 删除功能

1.根据前台传来的id做普通删除

2.根据brandid通过Example删除分类关系表中的数据



#### 新增功能

１.将前台传来的数据用DTO接收然后用工具类的．copyProperties方法转成实体类、

２.通过工具类PinyinUtil.getUpperCase方法把汉字转换成拼音String.valueOf将string类型的字符串转换为ｃｈａｒ类型的数组【】然后用toCharArray方法进行字符串截取　实现汉字识别和拼音首字母的截取

３.执行普通的品牌新增

４批量分类新增 / 新增

4.1得到分类集合字符串

4.2判断分类集合字符串中是否包含, （包含批量不包含普通新增）

4.3多个分类 --> 批量新增

5.普通单个分类新增

#### 查询功能

１分页

１.１通过分页工具类PageHelper.startPage方法把ｐａｇｅ和ｒｏｗｓ属性传进去实现分页功能

２.排序簡化版

２.２判断排序字段是否为空

２.３通过分页工具类PageHelper.orderBy方法把封装好的order传入进去（封装使用了Boolean．　				valueOf（）和三目运算）　实现排序功能

３.条件模糊查询
３.１通过copyProperties把ＤＴＯ转换为实体类　

３.２通过Example（实体类）创建条件查询

​       example.createCriteria().andLike(内放的是模糊查询的字段“％”＋需要用％和加号拼接＋“％”)

​		执行selectByExample（）语句

４．将查询结果放入ＰａｇｅＩｎｆｏ＜＞集合内　泛型实体类类型　

５.并将的ｌｉｓｔ集合放入this.setResultSuccess（）内返回给前台　

### 后台

#### mingrui-shop-service-api

com.baidu.shop.entity

先写BrandEntity实体类

```java
package com.baidu.shop.entity;

import lombok.Data;

import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.Table;

@Table(name = "tb_brand")
@Data
public class BrandEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Integer id;

    private String name;

    private String image;

    private Character letter;
}
```

#### mingrui-shop-service-api

继承BaseDTO

```java
package com.baidu.shop.dto;

import com.baidu.shop.base.BaseDTO;
import com.baidu.shop.validate.group.MingruiOperation;
import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;

import javax.validation.constraints.NotNull;

@ApiModel(value = "品牌DTO")
@Data
public class BrandDTO extends BaseDTO {

    @ApiModelProperty(value = "品牌主键",example = "1")
    @NotNull(message = "主键不能为空",groups = {MingruiOperation.Update.class})
    private Integer id;

    @ApiModelProperty(value = "品牌名称")
    @NotNull(message = "品牌名称不能为空",groups = {MingruiOperation.Update.class})
    private String name;

    @ApiModelProperty(value = "品牌 logo")
    private String image;

    @ApiModelProperty(value = "品牌首字母")
    private Character letter;

    @ApiModelProperty(value = "品牌id集合")
    private String categories;
}

```

#### mingrui-shop-service-api

添加BrandService接口

```java
package com.baidu.shop.service;

import com.alibaba.fastjson.JSONObject;
import com.baidu.shop.base.Result;
import com.baidu.shop.dto.BrandDTO;
import com.baidu.shop.entity.BrandEntity;
import com.baidu.shop.utils.JSONUtil;
import com.github.pagehelper.PageInfo;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import org.springframework.web.bind.annotation.*;

@Api(tags = "品牌接口")
public interface BrandService {

    @ApiOperation(value = "获取品牌信息")
    @GetMapping(value = "brand/list")
    Result<PageInfo<BrandEntity>> getBrandInfo(BrandDTO brandDTO);

    @ApiOperation(value = "品牌新增")
    @PostMapping(value = "brand/save")
    Result<JSONObject> saveBrandInfo(@RequestBody BrandDTO brandDTO);

    @ApiOperation(value = "品牌修改")
    @PutMapping(value = "brand/save")
    Result<JSONObject> editBrandInfo(@RequestBody BrandDTO brandDTO);

    @ApiOperation(value = "品牌删除")
    @DeleteMapping(value = "brand/deleteId")
    Result<JSONObject> deleteBrandInfo(Integer id);
}

```

#### mingrui-shop-service-xxx

com.baidu.shop.serviceImpl包下创建实现类BrandServiceImpl

```java
package com.baidu.shop.service.impl;

import com.alibaba.fastjson.JSONObject;
import com.baidu.shop.base.BaseApiService;
import com.baidu.shop.base.Result;
import com.baidu.shop.dto.BrandDTO;
import com.baidu.shop.entity.BrandEntity;
import com.baidu.shop.entity.CategoryBrandEntity;
import com.baidu.shop.entity.CategoryEntity;
import com.baidu.shop.mapper.BrandMapper;
import com.baidu.shop.mapper.CategoryBrandMapper;
import com.baidu.shop.service.BrandService;
import com.baidu.shop.utils.BaiduBeanUtil;
import com.baidu.shop.utils.JSONUtil;
import com.baidu.shop.utils.PinyinUtil;
import com.github.pagehelper.PageHelper;
import com.github.pagehelper.PageInfo;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.util.StringUtils;
import org.springframework.web.bind.annotation.RestController;
import tk.mybatis.mapper.entity.Example;
import javax.annotation.Resource;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.stream.Collectors;

@RestController
public class BrandServiceImpl extends BaseApiService implements BrandService {

    @Autowired
    private BrandMapper brandMapper;

    @Autowired
    private CategoryBrandMapper categoryBrandMapper;

    @Transactional
    @Override
    public Result<JSONObject> deleteBrandInfo(Integer id) {
        brandMapper.deleteByPrimaryKey(id);

        this.deleteCategoryByBrand(id);

        return this.setResultSuccess();
    }

    @Transactional
    @Override
    public Result<JSONObject> editBrandInfo(BrandDTO brandDTO) {
        BrandEntity brandEntity = BaiduBeanUtil.copyProperties(brandDTO, BrandEntity.class);
        brandEntity.setLetter(PinyinUtil.getUpperCase(String.valueOf(brandEntity.getName().toCharArray()[0]), false).toCharArray()[0]);
        brandMapper.updateByPrimaryKeySelective(brandEntity);

        this.deleteCategoryByBrand(brandEntity.getId());

        this.insertCategoryBrandList(brandDTO.getCategories(),brandEntity.getId());
        return this.setResultSuccess();
    }

    @Transactional
    @Override
    public Result<JSONObject> saveBrandInfo(BrandDTO brandDTO) {
        BrandEntity brandEntity = BaiduBeanUtil.copyProperties(brandDTO,BrandEntity.class);

        //处理品牌首字母
        brandEntity.setLetter(PinyinUtil.getUpperCase(String.valueOf(brandEntity.getName().toCharArray()[0]),false).toCharArray()[0]);

        brandMapper.insertSelective(brandEntity);

        this.insertCategoryBrandList(brandDTO.getCategories(),brandEntity.getId());

        return this.setResultSuccess();
    }



    @Override
    public Result<PageInfo<BrandEntity>> getBrandInfo(BrandDTO brandDTO) {

        //分页
        PageHelper.startPage(brandDTO.getPage(),brandDTO.getRows());

        if(!StringUtils.isEmpty(brandDTO.getSort())){
            //String order = "";
            //if (Boolean.valueOf(brandDTO.getOrder())){
            //    order = "desc";
            //}else{
            //    order = "asc";
            //}
            //PageHelper.orderBy(brandDTO.getSort()+ " " + (Boolean.valueOf(brandDTO.getOrder())? "desc" : "asc"));
            PageHelper.orderBy(brandDTO.getOrderBy());
        }

        Example example = new Example(BrandEntity.class);
        example.createCriteria().andLike("name","%"+brandDTO.getName()+"%");

        List<BrandEntity> brandEntities = brandMapper.selectByExample(example);
        PageInfo<BrandEntity> pageInfo  = new PageInfo<>(brandEntities);

        return this.setResultSuccess(pageInfo);
    }

    private void insertCategoryBrandList(String categories,Integer brandId){
        if(StringUtils.isEmpty(categories))throw new RuntimeException("分类信息不能为空");
        //判断分类集合中是否包含逗号","
        if(categories.contains(",")){
            categoryBrandMapper.insertList(
                    Arrays.asList(categories.split(","))
                            .stream()
                            .map(categoryIdStr -> new CategoryBrandEntity(Integer.valueOf(categoryIdStr)
                                    ,brandId))
                            .collect(Collectors.toList())
            );
        }else{
            CategoryBrandEntity categoryBrandEntity = new CategoryBrandEntity();
            categoryBrandEntity.setBrandId(brandId);
            categoryBrandEntity.setCategoryId(Integer.valueOf(categories));

            categoryBrandMapper.insertSelective(categoryBrandEntity);
        }
    }

    private void deleteCategoryByBrand(Integer brandId){
        Example example = new Example(CategoryBrandEntity.class);
        example.createCriteria().andEqualTo("brandId",brandId);
        categoryBrandMapper.deleteByExample(example);
    }
}

```

#### mingrui-shop-service-api-xxx

com.baidu.shop.entity

添加中间表CategoryBrandEntity

```java
package com.baidu.shop.entity;


import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import javax.persistence.Table;

@Table(name = "tb_category_brand")
@Data
@NoArgsConstructor
@AllArgsConstructor
public class CategoryBrandEntity {

    private Integer categoryId;

    private Integer brandId;

}

```

mingrui-shop-common-core


 添加分页排序的字段

com.baidu.shop.base包下中添加BaseDTO

```java
package com.baidu.shop.base;

import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;

@Data
@ApiModel(value = "BaseDTO用于数据传输,其他dto需要继承此类")
public class BaseDTO {

    @ApiModelProperty(value = "当前页",example = "1")
    private Integer page;

    @ApiModelProperty(value = "每页显示多少条",example = "5")
    private Integer rows;

    @ApiModelProperty(value = "排序字段")
    private String sort;

    @ApiModelProperty(value = "是否升序")
    private String order;

    public String getOrderBy(){
        return sort + " " + (Boolean.valueOf(order) ? "desc" : "asc");
    }
}

```

## 查询

在前台创建	MrBrand.vue

```js
    <!-- 表格组件 -->
    <v-data-table
      :headers="headers"
      :items="desserts"
      :pagination.sync="pagination"
      :total-items="total"
      class="elevation-1"
    >
      <template slot="items" slot-scope="props">
        <td class="text-xs-center">{{ props.item.id }}</td>
        <td class="text-xs-center">{{ props.item.name }}</td>
        <td class="text-xs-center">
          <!-- src 是html标签的属性 :src="vue的属性" -->
          <img width="100px" :src="props.item.image" />
        </td>
        <td class="text-xs-center">{{ props.item.letter }}</td>
        <td class="text-xs-center">
          <v-btn flat icon color="blue" @click="editData(props.item)">
            <v-icon>edit</v-icon>
          </v-btn>
          <v-btn flat icon color="red" @click="deleteId(props.item.id)">
            <v-icon>delete</v-icon>
          </v-btn>
        </td>
      </template>
    </v-data-table>
  </v-card>
</template>
<script>
import MrBrandForm from './MrBrandForm';
export default {
  name: "MrBrand",
  components:{
    MrBrandForm
  },
  data() {
    return {
      brandDetail:{},
      isEdit:false,
      pagination: {},
      dialog:false,
      total: 0,
      search: "",
      headers: [
        {
          text: "id",
          align: "center",
          value: "id",
        },
        {
          text: "品牌名称",
          align: "center",
          value: "name",
        },
        {
          text: "品牌logo",
          width:"50px",
          align: "center",
          value: "image",
        },
        {
          text: "首字母",
          align: "center",
          value: "letter",
        },
        {
          text: "操作",
          align: "center",
          sortable: false,
          value: "id",
        },
      ],
      desserts: [],
    };
  },
  mounted() {
    this.getTableData();
  },
  methods: {
    getTableData() {
      this.$http
        .get("/brand/list", {
          params: {
            page: this.pagination.page,
            rows: this.pagination.rowsPerPage,
            sort: this.pagination.sortBy,
            order: this.pagination.descending,
            name: this.search
          },
        })
        .then((resp) => {
          this.desserts = resp.data.data.list;
          this.total = resp.data.data.total;
        })
        .catch((error) => console.log(error));
    }
  },
  watch: {
    pagination() {
      this.getTableData();
    }
  }
};
</script>
```

### 在mingrui-shop-service-api-xxx下新建BrandService

```java
    @ApiOperation(value = "获取品牌信息")
    @GetMapping(value = "brand/list")
    Result<PageInfo<BrandEntity>> getBrandInfo(BrandDTO brandDTO);
```

### 在mapper包下新建BrandMapper

```java
package com.baidu.shop.mapper;

import com.baidu.shop.entity.BrandEntity;
import tk.mybatis.mapper.common.Mapper;

public interface BrandMapper extends Mapper<BrandEntity> {
}
```

### 在mingrui-shop-service-xxx下新建BrandService接口的实现类BrandServiceImpl

```java
    @Override
    public Result<PageInfo<BrandEntity>> getBrandInfo(BrandDTO brandDTO) {

        //分页
        PageHelper.startPage(brandDTO.getPage(),brandDTO.getRows());

        if(!StringUtils.isEmpty(brandDTO.getSort())){
            //String order = "";
            //if (Boolean.valueOf(brandDTO.getOrder())){
            //    order = "desc";
            //}else{
            //    order = "asc";
            //}
            //PageHelper.orderBy(brandDTO.getSort()+ " " + (Boolean.valueOf(brandDTO.getOrder())? "desc" : "asc"));
            PageHelper.orderBy(brandDTO.getOrderBy());
        }

        Example example = new Example(BrandEntity.class);
        example.createCriteria().andLike("name","%"+brandDTO.getName()+"%");

        List<BrandEntity> brandEntities = brandMapper.selectByExample(example);
        PageInfo<BrandEntity> pageInfo  = new PageInfo<>(brandEntities);

        return this.setResultSuccess(pageInfo);
    }
```

## 新增

###  在utils包下新建BaiduBeanUtil

```java
package com.baidu.shop.utils;

import com.sun.org.apache.bcel.internal.generic.RETURN;
import org.springframework.beans.BeanUtils;

public class BaiduBeanUtil<T> {
    public static <T> T copyProperties(Object source,Class<T> clazz){

        try {
            T t = clazz.newInstance();
            BeanUtils.copyProperties(source,t);
            return t;
        } catch (InstantiationException e) {
            e.printStackTrace();
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        }
        return null;
    }
}
```

### BrandDTO

```java
    @ApiModelProperty(value = "品牌id集合")
    private String categories;
```

### entity包下新建中间表CategoryBrandEntity

用于保存商品分类和品牌分类的id

通过这张表让他们连接起来

```java
package com.baidu.shop.entity;


import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import javax.persistence.Table;

@Table(name = "tb_category_brand")
@Data
@NoArgsConstructor
@AllArgsConstructor
public class CategoryBrandEntity {

    private Integer categoryId;

    private Integer brandId;
}
```

### BrandService下写入新增接口

```java
    @ApiOperation(value = "品牌新增")
    @PostMapping(value = "brand/save")
    Result<JSONObject> saveBrandInfo(@RequestBody BrandDTO brandDTO);
```

### 在mapper包下新建CategoryBrandMapper

```java
public interface CategoryBrandMapper extends Mapper<CategoryBrandEntity>,InsertListMapper<CategoryBrandEntity> {     		

}
```

### BrandServiceImpl实现类下

```java
    @Transactional
    @Override
    public Result<JSONObject> saveBrandInfo(BrandDTO brandDTO) {
        BrandEntity brandEntity = BaiduBeanUtil.copyProperties(brandDTO,BrandEntity.class);

        //处理品牌首字母
        brandEntity.setLetter(PinyinUtil.getUpperCase(String.valueOf(brandEntity.getName().toCharArray()[0]),false).toCharArray()[0]);

        brandMapper.insertSelective(brandEntity);

        this.insertCategoryBrandList(brandDTO.getCategories(),brandEntity.getId());

        return this.setResultSuccess();
    }
```

###  封装工具类的方法

```java
private void insertCategoryBrandList(String categories,Integer brandId){
        if(StringUtils.isEmpty(categories))throw new RuntimeException("分类信息不能为空");
        //判断分类集合中是否包含逗号","
        if(categories.contains(",")){
            categoryBrandMapper.insertList(
                    Arrays.asList(categories.split(","))
                            .stream()
                            .map(categoryIdStr -> new CategoryBrandEntity(Integer.valueOf(categoryIdStr)
                                    ,brandId))
                            .collect(Collectors.toList())
            );
        }else{
            CategoryBrandEntity categoryBrandEntity = new CategoryBrandEntity();
            categoryBrandEntity.setBrandId(brandId);
            categoryBrandEntity.setCategoryId(Integer.valueOf(categories));

            categoryBrandMapper.insertSelective(categoryBrandEntity);
        }
    }
```

```java
	private void deleteCategoryByBrand(Integer brandId){
        Example example = new Example(CategoryBrandEntity.class);
        example.createCriteria().andEqualTo("brandId",brandId);
        categoryBrandMapper.deleteByExample(example);
    }
```

## 修改

### mingrui-shop-service-api-xxx下添加修改接口

###  CategoryService

```java
    @ApiOperation(value = "通过id修改")
    @PutMapping(value = "/category/edit")
    Result<JSONObject> editCategoryByPid(@Validated({MingruiOperation.Update.class}) @RequestBody 		CategoryEntity categoryEntity);
```

### CategoryMapper写自定义查询语句

```
package com.baidu.shop.mapper;

import com.baidu.shop.entity.CategoryEntity;
import org.apache.ibatis.annotations.Select;
import tk.mybatis.mapper.common.Mapper;

import java.util.List;

public interface CategoryMapper extends Mapper<CategoryEntity> {

    @Select(value = "select id,name from tb_category where id in (select category_id from tb_category_brand where brand_id=#{brandId})")
    List<CategoryEntity> getCategoryByBrandId(Integer brandId);
}
```

### CategoryServiceImpl

```java
    @Override
    public Result<List<CategoryEntity>> getCategoryByBrandId(Integer brandId) {
        List<CategoryEntity> list = categoryMapper.getCategoryByBrandId(brandId);
        return this.setResultSuccess(list);
    }
```

### BrandService

```java
    @ApiOperation(value = "品牌修改")
    @PutMapping(value = "brand/save")
    Result<JSONObject> editBrandInfo(@RequestBody BrandDTO brandDTO);
```

### BrandServiceImpl

```java
    @Transactional
    @Override
    public Result<JSONObject> editBrandInfo(BrandDTO brandDTO) {
        BrandEntity brandEntity = BaiduBeanUtil.copyProperties(brandDTO, BrandEntity.class);
        brandEntity.setLetter(PinyinUtil.getUpperCase(String.valueOf(brandEntity.getName().toCharArray()[0]), false).toCharArray()[0]);
        brandMapper.updateByPrimaryKeySelective(brandEntity);

        this.deleteCategoryByBrand(brandEntity.getId());

        this.insertCategoryBrandList(brandDTO.getCategories(),brandEntity.getId());
        return this.setResultSuccess();
    }
```







------



# 分类项目总结

#### 删除功能

------

![hhh](C:\Users\86158\Desktop\桌面文件夾\hhh.png)

------

#### 修改功能

普通的修改没有逻辑

１．接受前台传来的entity

２.执行updateByPrimaryKeySelective

３.返回this.setResultSuccess()方法

​	

#### 新增功能

１.根据传来的值判断当前节点ｉｓParent是否为１如果为０则修改为１

２.ｎｅｗ实体类把１赋进去把parentid也Fiji去　　执行修改操作

３.再执行新增操作

４.无返回值

#### 查询功能

１.将前台传来的id存到实体类中

２.将ｐｉｄ存到.setParentId(pid);内

３.执行select(categoryEntity);方法

５.返回this.setResultSuccess(list);



# 规格参数

### 查询

通过分类id查询数据

判断cid不能为空

用specGroupDTO.getCid()做条件查询分类

查询成功后通过this.成功回调函数返回集合数据

### 新增

普通新增

把前台传过来的值通过BaiduBeanUtil.copyProperties函数转换成实体类

执行insertSelective方法

返回成功回调函数

### 删除

普通删除

接收前台传来的id属性

执行deleteByPrimaryKey方法

返回成功回调函数

### 修改

普通修改

把前台传过来的值通过BaiduBeanUtil.copyProperties函数转换成实体类

执行updateByPrimaryKeySelective方法

返回成功回调函数

##  查询

#### mingrui-shop-service-api-xxx

com.baidu.shop.entity新建：SpecGroupEntity

```
import lombok.Data;

import javax.persistence.Id;
import javax.persistence.Table;

@Table(name = "tb_spec_group")
@Data
public class SpecGroupEntity {
    @Id
    private Integer id;

    private Integer cid;

    private String name;
}
```

com.baidu.shop.dto新建：SpecGroupDto

```
import com.baidu.shop.base.BaseDTO;
import com.baidu.shop.validate.group.MingruiOperation;
import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;

import javax.validation.constraints.NotEmpty;
import javax.validation.constraints.NotNull;

@ApiModel(value = "规格分组")
@Data
public class SpecGroupDto extends BaseDTO {

    @ApiModelProperty(value = "主键",example = "1")
    @NotNull(message = "主键不能为空",groups = {MingruiOperation.Update.class})
    private Integer id;

    @ApiModelProperty(value = "类型id",example = "1")
    @NotNull(message = "类型id不能为空",groups = {MingruiOperation.Add.class})
    private Integer cid;

    @ApiModelProperty(value = "规格组名称",example = "1")
    @NotEmpty(message = "规格组名称不能为空",groups = {MingruiOperation.Add.class})
    private String name;
}
```

com.baidu.shop.service新建：

SpecGroupService

```
package com.baidu.shop.service;

import com.baidu.shop.base.Result;
import com.baidu.shop.dto.SpecGroupDto;
import com.baidu.shop.entity.SpecGroupEntity;
import com.google.gson.JsonObject;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiModelProperty;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@Api(value ="规格组接口")
public interface SpecGroupService {

    @ApiModelProperty(value = "规格组查询")
    @GetMapping(value = "specGroup/getSpecGroupInfo")
    Result<List<SpecGroupEntity>> getSpecGroupInfo(SpecGroupDto specGroupDto);
}
```

#### mingrui-shop-service-xxx

com.baidu.shop.mapper新建：

SpecGroupMapper

```
package com.baidu.shop.mapper;

import com.baidu.shop.entity.SpecGroupEntity;
import tk.mybatis.mapper.common.Mapper;

public interface SpecGroupMapper extends Mapper<SpecGroupEntity> {
}

```

com.baidu.shop.service.impl新建SpecGroupServiceImpl

```
import com.baidu.shop.base.BaseApiService;
import com.baidu.shop.base.Result;
import com.baidu.shop.dto.SpecGroupDTO;
import com.baidu.shop.entity.SpecGroupEntity;
import com.baidu.shop.mapper.SpecGroupMapper;
import com.baidu.shop.service.SpecificationService;
import com.baidu.shop.utils.ObjectUtil;
import org.springframework.util.StringUtils;
import org.springframework.web.bind.annotation.RestController;
import tk.mybatis.mapper.entity.Example;
import javax.annotation.Resource;
import java.util.List;

@RestController
public class SpecGroupServiceImpl extends BaseApiService implements SpecGroupService {

    @Resource
    private SpecGroupMapper specGroupMapper;
    
    //规格组查询
    @Override
    public Result<List<SpecGroupEntity>> getSpecGroupInfo(SpecGroupDto specGroupDto) {
        Example example = new Example(SpecGroupEntity.class);

        if (ObjectUtil.isNotNull(specGroupDto.getCid()))
                example
                .createCriteria()
                .andEqualTo("cid", BaiduBeanUtil.copyProperties(specGroupDto,SpecGroupEntity.class).getCid());

        List<SpecGroupEntity> specGroupExample = specGroupMapper.selectByExample(example);
        return this.setResultSuccess(specGroupExample);
    }
}
```

###  页面

加载分类信息

index.js line:29

```
route("/item/specification",'/item/specification/Specification',"Specification"),
```

 specification/Specification.vue

```
<v-tree url="/specGroup/getSpecGroupInfo" :isEdit="false" @handleClick="handleClick"/>
```

查询

SpecGroup.vue

```
loadData(){
          this.$http.get("/specGroup/getSpecGroupInfo",{
              params:{
                  cid:this.cid
              }
          })
          .then((resp) => {
              this.groups = resp.data.data;
          })
          .catch(() => {
              this.groups = [];
          })
      },
```

##  新增,删除,修改

#### mingrui-shop-service-api-xxx

com.baidu.shop.service：SpecGroupService

```
@ApiModelProperty(value = "新增规格组")
@PostMapping(value = "specGroup/save")
Result<JsonObject> saveSpecGroup(@RequestBody SpecGroupDto specGroupDto);

@ApiModelProperty(value = "修改规格组")
@PutMapping(value = "specGroup/save")
Result<JsonObject> editSpecGroup(@RequestBody SpecGroupDto specGroupDto);

@ApiModelProperty(value = "删除规格组")
@DeleteMapping("specGroup/delete/{id}")
Result<JsonObject> delSpecRoupById(@PathVariable Integer id);
```

mingrui-shop-service-xxx

com.baidu.shop.service.impl：

SpecGroupServiceImpl

```
//规格组新增
@Transactional
@Override
public Result<JsonObject> saveSpecGroup(SpecGroupDto specGroupDto) {
    specGroupMapper.insertSelective(BaiduBeanUtil.copyProperties(specGroupDto,SpecGroupEntity.class));
    return this.setResultSuccess();
}

//规格组修改
@Override
public Result<JsonObject> editSpecGroup(SpecGroupDto specGroupDto) {
    specGroupMapper.updateByPrimaryKeySelective(BaiduBeanUtil.copyProperties(specGroupDto,SpecGroupEntity.class));
    return this.setResultSuccess();
}

//规格组删除

@Override
public Result<JsonObject> delSpecRoupById(Integer id) {
    //删除规格组之前要先判断一下当前规格组下是否有规格参数
    //true : 不能被删除
    //false -->
    Example example = new Example(SpecParamEntity.class);
    example.createCriteria().andEqualTo("groupId",id);
    List<SpecParamEntity> specParamEntities = specParamMapper.selectByExample(example);
    if (specParamEntities.size() >0){
        return this.setResultError("当前规格组有数据不能被删除");
    }

    specGroupMapper.deleteByPrimaryKey(id);
    return this.setResultSuccess();
}
```

### 页面

 SpecGroup.vue

```
save(){
           this.$http({
            method: this.isEdit ? 'put' : 'post',
            url: 'specGroup/save',
            data: this.group
          }).then((resp) => {
            // 关闭窗口
            if(resp.data.code == 200){
                this.show = false;
                this.$message.success("保存成功！");
                this.loadData();
            }
           
          }).catch(() => {
              this.$message.error("保存失败！");
            });
      },
      deleteGroup(id){
          this.$message.confirm("确认要删除分组吗？")
          .then(() => {
            this.$http.delete("/specGroup/delete/ " + id)
                .then((resp) => {
                    if(resp.data.code!=200){
                        this.$message.error(resp.data.message);
                        this.loadData();
                        return
                    }
                    this.loadData();
                    this.$message.success("删除成功")
                })
          })
      },
```

## 

# 商品列表

### 查询

前台

```
<v-btn-toggle mandatory v-model="search.saleable">
<!--将此处改为number类型的值比较好处理-->
<v-btn flat :value="2">
全部
</v-btn>
<v-btn flat :value="0">
上架
</v-btn>
<v-btn flat :value="1">
下架
</v-btn>
</v-btn-toggle>
```





```
  getDataFromApi() {
        this.loading = true;
        this.$http.get('goods/getSpuInfo',{
          params:{
            page:this.pagination.page,
            rows:this.pagination.rowsPerPage,
            sort:this.pagination.sortBy,
            order:this.pagination.descending,
            saleable:this.search.saleable,
            title:this.search.key
          },
         }).then(resp => {
          this.items = resp.data.data;
          //this.totalItems = resp.data.message - 0;
          this.totalItems = parseInt(resp.data.message);
          this.loading = false;
        }).catch(error => console.log(error))
        // setTimeout(() => {
        //   // 返回假数据
        //   this.items = goodsData.slice(0, 4);
        //   this.totalItems = 25;
        //   this.loading = false;
        // }, 300)
      }
```



##### 新建实体类SpuEntity

```
package com.baidu.shop.entity;

import com.baidu.shop.validate.group.MingruiOperation;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;

import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.Table;
import javax.validation.constraints.NotEmpty;
import javax.validation.constraints.NotNull;
import java.util.Date;

/**
 * 2 *@ClassName SpuEntity
 * 3 *@Description: TODO
 * 4 *@Author 王振方
 * 5 *@Date 2021/1/5
 *
 * @Version V1.0
 * 7
 **/
@Data
@Table(name = "tb_spu")
public class SpuEntity{

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @ApiModelProperty(value = "spu主鍵",example = "1")
    @NotNull(message = "主键不能为空",groups = {MingruiOperation.Update.class})
    private Integer id;

    @ApiModelProperty(value = "标题")
    @NotEmpty(message = "标题不能为空",groups = {MingruiOperation.Update.class,MingruiOperation.Add.class})
    private String title;

    private String subTitle;

    @ApiModelProperty(value = "cid1",example = "1")
    @NotNull(message = "cid1不能为空",groups = {MingruiOperation.Update.class,MingruiOperation.Add.class})
    private Integer cid1;

    @ApiModelProperty(value = "cid2",example = "1")
    @NotNull(message = "cid2不能为空",groups = {MingruiOperation.Update.class,MingruiOperation.Add.class})
    private Integer cid2;

    @ApiModelProperty(value = "cid3",example = "1")
    @NotNull(message = "cid3不能为空",groups = {MingruiOperation.Update.class,MingruiOperation.Add.class})
    private Integer cid3;

    @ApiModelProperty(value = "品牌id",example = "1")
    @NotNull(message = "品牌id不能为空",groups = {MingruiOperation.Update.class,MingruiOperation.Add.class})
    private Integer brandId;

    @ApiModelProperty(value = "是否上架",example = "1")
    @NotNull(message = "上架下架不能为空",groups = {MingruiOperation.Update.class,MingruiOperation.Add.class})
    private Integer saleable;

    @ApiModelProperty(value = "有效",example = "1")
    @NotNull(message = "有效信息不能为空",groups = {MingruiOperation.Update.class,MingruiOperation.Add.class})
    private Integer valid;

    private Date createTime;

    private Date lastUpdateTime;



}

```

新建SpuDTO

```
package com.baidu.shop.dto;

import com.baidu.shop.base.BaseDTO;
import com.baidu.shop.validate.group.MingruiOperation;
import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import io.swagger.annotations.ApiOperation;
import lombok.Data;

import javax.validation.constraints.NotEmpty;
import javax.validation.constraints.NotNull;
import java.util.Date;
import java.util.List;

/**
 * 2 *@ClassName SpuDTO
 * 3 *@Description: TODO
 * 4 *@Author 王振方
 * 5 *@Date 2021/1/5
 *
 * @Version V1.0
 * 7
 **/
@ApiModel(value = "spu数据传输DTO")
@Data
public class SpuDTO extends BaseDTO {
    @ApiModelProperty(value = "主键",example = "1")
    @NotNull(message = "主键不能为空",groups = {MingruiOperation.Update.class})
    private Integer id;

    @ApiModelProperty(value = "标题")
    @NotEmpty(message = "标题不能为空",groups = {MingruiOperation.Add.class})
    private  String title;

    @ApiModelProperty(value = "子标题")
    private String subTitle;

    @ApiModelProperty(value = "1级类目id", example = "1")
    @NotNull(message = "1级类目id不能为空",groups = {MingruiOperation.Add.class})
    private Integer cid1;

    @ApiModelProperty(value = "2级类目id", example = "1")
    @NotNull(message = "2级类目id不能为空",groups = {MingruiOperation.Add.class})
    private Integer cid2;

    @ApiModelProperty(value = "3级类目id", example = "1")
    @NotNull(message = "3级类目id不能为空",groups = {MingruiOperation.Add.class})
    private Integer cid3;

    @ApiModelProperty(value = "商品所属品牌id", example = "1")
    @NotNull(message = "商品所属品牌id不能为空",groups = {MingruiOperation.Add.class})
    private Integer brandId;

    //不需要验证,新增时直接设置默认值
    @ApiModelProperty(value = "是否上架，0下架，1上架", example = "1")
    @NotNull(message = "上架下架不能为空",groups = {MingruiOperation.Update.class,MingruiOperation.Add.class})
    private Integer saleable;

    //不需要验证,新增时直接设置默认值
    @ApiModelProperty(value = "是否有效，0已删除，1有效", example = "1")
    @NotNull(message = "有效信息不能为空",groups = {MingruiOperation.Update.class,MingruiOperation.Add.class})
    private Integer valid;

    //不需要验证,新增时直接设置默认值
    @ApiModelProperty(value = "添加时间")
    private Date createTime;
    //不需要验证,新增时直接设置默认值,修改时使用java代码赋值

    @ApiModelProperty(value = "最后修改时间")
    private  Date lastUpdateTime;

    private String categoryName;

    private String brandName;

    @ApiModelProperty(value = "大字段数据")
    private SpuDetailDTO spuDetail;

    @ApiModelProperty(value = "sku属性数据集合")
    private List<SkuDTO> skus;



}

```



### 新增



### 修改



### 删除

### 







